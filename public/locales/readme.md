# I18n

If you come across any issues with the translation setup, just send a message in [dev-chat](https://discord.com/channels/800607517074784256/1198367043167195246) on the discord server

### Adding a new language

When adding a new language
- create a new locale file in `public/locales` if the appropriate one does not yet exist.
  - in `generateTranslations.ts`, modify the `outputLocaleMapping` as necessary so that future gameData updates are also applied to the newly created locale, and then copy paste the relevant `gameData.json` file into the newly created locale folder
- in `generateTranslations.ts`, modify `getTbName` to set the proper name for Stelle/Caelus for your locale if it is not already done.
- add the new language to the list of languages in `lib/src/i18n.ts` if it does not already exist, and add a flag in `public/assets/misc/flags`, with the name `[locale].webp`.
- once the translation has been completed, add the language to the list of completed languages in `src/lib/components/LanguageSelector.tsx`.

### Adding new text
When any displayed text is added to the webpage, it should be done directly through the i18n setup.
- Add the new translation strings in the relevant en json file
  - if a new file is necessary, make sure to add it to the loaded namespaces in `src/lib/i18n.ts`
- Send a message in the discord server to notify other translators of the new text.
- Leave the en translation next to the t function in the code as a code comment
    `const message = t('Thing.Messages.Success') /*'Operation successful'*/`

### Updating gameData.json

These files are generated by using the `generateTranslations.ts` file in `misc/i18n`.
Before running the script, update if necessary the beta information in `misc/i18n/betaInformation`.
- The english information must include the most recent beta information before running the script, other languages can also have beta information added to `gameData.json` by making a new entry in the `betaInformation` object.
- Outdated content that is now available in game can be removed but will not cause issues if left behind.

Run the script by typing `npx tsx misc/i18n/generateTranslations.ts` in the command line from the root directory.
Use the files rom Dim's public repo, making sure that they are up to date prior to running the script.

### Updating other files

The translation works by mapping a key to a text string that will be displayed on the user's screen, the recommended workflow is to take the `en` translation files and simply translate the values from there. Some keys may have a `_zero`, `_other`, or `_one` suffix, these suffixes are for pluralization, if your language has more or less plural forms then you will need to add/remove keys as necessary. More detailed information can be found in the [i18next documentation](https://react.i18next.com/).

You will also come across some translations that look like the following: `"key": "valueTextPart1 $t(namespace:key, {options}) valueTextPart2"`, this is used to reference an already existing translation within a translation string, e.g. you may want to refer to the name of the import tab tab within one of your strings (`"key": "you can import your relics and characters in the $t(sidebar:Optimization.Import) tab"`), this will allow you to do so without having to change the string in question if the import tab where to ever be renamed.

You will see some translation strings inlude double braced words (`Immediately draws 2 jade tile(s) and increases DMG by {{skillStackDmg}}% until the end of the current turn. This effect can stack up to 4 time(s).`), this is used for interpolation, i.e. when the translation includes a dynamic value that must be provided by the code. Here skillStackDmg will depend on Qingque's eidolon level, so the number can't be included in the translation string, so it is instead double braced such that the code can provide the value once it is determined.

Finally, some strings follow a slightly different construction. When a string includes special formatting (e.g. **bold text** or `codeblocks`), the formatting must be provided within the translation files. When this is the case, you will see numbered tags embeded within the translation string (e.g. `"<0>someText</0><1>Some more Text</1>"`). In this case, it is likely easier to first find the corresponding text within the code and translate from that rather than attempting to translate the original english string. Information on how the numbered tags work can be found [here](https://react.i18next.com/latest/trans-component), but if you have any questions feel free to ask them in the [discord server](https://discord.gg/YHCCaXEhfV).
